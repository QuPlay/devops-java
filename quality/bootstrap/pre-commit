#!/bin/bash
# ==============================================================================
# Bootstrap Pre-commit Hook
#
# This file should be committed to .githooks/ in each project.
# It delegates to the full hooks installed in .git/hooks/
# ==============================================================================

FULL_HOOK=".git/hooks/pre-commit"
VERSION_FILE=".git/hooks/.version"

# Check if full hooks are installed
if [ ! -f "$VERSION_FILE" ]; then
    echo "[DevOps] Git Hooks 未安装，正在自动安装..."
    curl -fsSL https://raw.githubusercontent.com/QuPlay/devops-java/main/scripts/install-hooks.sh | bash
    EXIT_CODE=$?

    if [ $EXIT_CODE -ne 0 ] && [ $EXIT_CODE -ne 100 ]; then
        echo "[DevOps] 安装失败，跳过检查"
        exit 0
    fi
fi

# Delegate to full hook
if [ -x "$FULL_HOOK" ]; then
    exec "$FULL_HOOK" "$@"
else
    echo "[DevOps] 警告: 完整 hooks 未找到，跳过检查"
    exit 0
fi
